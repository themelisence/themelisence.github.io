function Particle(t,e,i){this._x=0,this._y=0,this._xVelocity=50,this._yVelocity=50,this._context=t,this._innerColor="rgba(0, 0, 0, 0.2)",this._outerColor="rgba(0, 0, 0, 0)",this._radius=128,this._canvasWidth=e,this._canvasHeight=i}Particle.prototype.Draw=function(){var t=this._context.createRadialGradient(this._x,this._y,5,this._x,this._y,this._radius);t.addColorStop(0,this._innerColor),t.addColorStop(1,this._outerColor),this._context.beginPath(),this._context.arc(this._x,this._y,this._radius,0,2*Math.PI),this._context.fillStyle=t,this._context.fill(),this._context.closePath()},Particle.prototype.Update=function(t){this._x+=this._xVelocity*t,this._y+=this._yVelocity*t,this._x>=this._canvasWidth?(this._xVelocity=-this._xVelocity,this._x=this._canvasWidth):this._x<=0&&(this._xVelocity=-this._xVelocity,this._x=0),this._y>=this._canvasHeight?(this._yVelocity=-this._yVelocity,this._y=this._canvasHeight):this._y<=0&&(this._yVelocity=-this._yVelocity,this._y=0),this._x=Math.round(this._x),this._y=Math.round(this._y)},Particle.prototype.SetPosition=function(t,e){this._x=t,this._y=e},Particle.prototype.SetVelocity=function(t){this._xVelocity=this.GenerateRandom(-t,t),this._yVelocity=this.GenerateRandom(-t,t)},Particle.prototype.SetRadius=function(t){this._radius=t},Particle.prototype.SetColor=function(t,e){this._innerColor="rgba("+t[0]+", "+t[1]+", "+t[2]+", "+e+")",this._outerColor="rgba("+t[0]+", "+t[1]+", "+t[2]+", 0)"},Particle.prototype.GenerateRandom=function(t,e){return Math.random()*(e-t)+t},function(t){var e="SmokeEffect",i=function(t){var e,i;return(e=document.createElement("canvas")).height=1,e.width=1,(i=e.getContext("2d")).fillStyle=t,i.fillRect(0,0,1,1),i.getImageData(0,0,1,1).data},o=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(t){return setTimeout(t,15)},a={init:function(a){return this.each(function(){var r=t(this),c=t.extend({color:"black",opacity:.2,density:10,maximumVelocity:50,particleRadius:150},a);if(!r.data(e)){var n;c.width=r.outerWidth(),c.height=r.outerHeight(),"CANVAS"==r.prop("tagName")?(n=r[0],c.isCanvas=!0):((n=document.createElement("CANVAS")).width=c.width,n.height=c.height,c.isCanvas=!1),n&&n.getContext?(c.context=n.getContext("2d"),c.color=i(c.color)):t.error("Cannot create SmokeEffect because the browser lacks support"),r.data(e,c),r.SmokeEffect("createParticles");var h=0,s=function(){var t=new Date;t-h>66&&(r.SmokeEffect("update",t-h),h=t),o(s)};s(h)}})},createParticles:function(){return this.each(function(){var i,o,a,r,c,n=t(this),h=n.data(e);if(h&&h.context){for(var s=h.particles||[],l=(i=h.width,o=h.height,a=h.density,r=h.particleRadius,c=i*o/(r*r*Math.PI),Math.ceil(a*c));s.length>l;)h.particles.pop();for(;s.length<l;){var d=new Particle(h.context,h.width,h.height);d.SetPosition(d.GenerateRandom(0,h.width),d.GenerateRandom(0,h.height)),d.SetVelocity(h.maximumVelocity),d.SetRadius(h.particleRadius),d.SetColor(h.color,h.opacity),s.push(d)}h.particles=s,n.data(e,h)}})},update:function(i){var o=t(this).data(e);if(o&&o.context){var a=t(this),r=a.outerWidth(),c=a.outerHeight();if(o.width!=r||o.height!=c)return void a.SmokeEffect("resize");o.context.clearRect(0,0,o.width,o.height);var n=Math.min(i/1e3,1);if(o.particles.forEach(function(t){t.Update(n),t.Draw()}),!o.isCanvas){var h=new Image;h.onload=function(){a.css("backgroundImage","url("+this.src+")")},h.src=o.context.canvas.toDataURL()}}},resize:function(){return this.each(function(){var i=t(this),o=i.data(e);if(o.width=i.outerWidth(),o.height=i.outerHeight(),o.particles=[],o.isCanvas)i.get(0).width=o.width,i.get(0).height=o.height;else{var a=document.createElement("CANVAS");a.width=o.width,a.height=o.height,a&&a.getContext&&(o.context=a.getContext("2d"))}i.data(e,o),i.SmokeEffect("createParticles")})},option:function(o,a){var r=t(this),c=r.data(e);if("string"==typeof o){if(void 0==a)return c[o];c[o]=a}else c=t.extend(c,o);switch(o){case"maximumVelocity":c.particles.forEach(function(t){t.SetVelocity(a)});break;case"particleRadius":c.particles.forEach(function(t){t.SetRadius(a)});break;case"color":c.color=i(a),c.particles.forEach(function(t){t.SetColor(c.color,c.opacity)});break;case"opacity":c.particles.forEach(function(t){t.SetColor(c.color,a)});break;case"density":r.SmokeEffect("createParticles")}r.data(e,c)}};t.fn.SmokeEffect=function(i){return a[i]?a[i].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof i&&i?void t.error("Method '"+i+"' does not exist on plugin '"+e+"'"):a.init.apply(this,arguments)}}(jQuery);