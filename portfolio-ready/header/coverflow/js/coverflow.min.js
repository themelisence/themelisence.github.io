!function(e,t){"use strict";var n=function(e){return e<0?-1:1},i=function(e,t,n,i,o){return(e-t)*(o-i)/(n-t)+i},o="onwheel"in document?"wheel":"mousewheel";e.widget("vanderlee.coverflow",{options:{animateComplete:t,animateStart:t,animateStep:t,density:1,duration:"normal",easing:t,enableKeyboard:"both",enableClick:!0,enableWheel:!0,index:0,innerAngle:-75,innerCss:t,innerOffset:100/3,innerScale:.75,outerAngle:-30,outerCss:t,outerScale:.25,selectedCss:t,visible:"density",width:t,change:t,confirm:t,select:t},_window_handler_resize:null,_window_handler_keydown:null,_create:function(){var t,n=this,i=n._getCovers(),s=i.filter("img").add("img",i).filter(function(){return!(this.complete||this.height>0)}),r=Math.max.apply(null,i.map(function(){return e(this).height()}).get());return n.widgetEventPrefix="vanderlee-coverflow",n.hovering=!1,n.pagesize=1,n.currentIndex=n.options.index,n.element.height(r),s.on(function(){(t=n._getCovers().height())>r&&(r=t,n.element.height(r))}),i.hide(),this.element.not(":tabbable")&&(this.element.attr("tabIndex",-1),this.element.attr("autofocus")&&this.element.focus()),n.element.on("mousedown tap","> *",function(e){if(n.options.enableClick){var t=n._getCovers().index(this);t===n.currentIndex?n._callback("confirm",e):n._setIndex(t,!0)}}),n.element.on(o,function(e){if(n.options.enableWheel){var t=("deltaY"in(i=e).originalEvent?0-i.originalEvent.deltaY:"wheelDelta"in i.originalEvent?i.originalEvent.wheelDelta:void 0)>0?1:-1;e.preventDefault(),n._setIndex(n.options.index-t,!0)}var i}),e.isFunction(n.element.swipe)&&n.element.swipe({allowPageScroll:"vertical",swipe:function(e,t,i,o,s){var r=Math.round(1.25*("left"===t?1:"right"===t?-1:0)*n.pagesize*i/n.element.width());n._setIndex(n.options.index+r,!0)}}),n._window_handler_resize=function(){n.refresh()},e(window).on("resize",n._window_handler_resize),n._window_handler_keydown=function(t){if(e.inArray(n.options.enableKeyboard,[!0,"both","focus"])>=0&&n.element.is(":focus")||e.inArray(n.options.enableKeyboard,[!0,"both","hover"])>=0>=0&&n.element.is(":hover"))switch(t.which){case 36:t.preventDefault(),n._setIndex(0,!0);break;case 35:t.preventDefault(),n._setIndex(n._getCovers().length-1,!0);break;case 38:case 37:t.preventDefault(),n._setIndex(n.options.index-1,!0);break;case 40:case 39:t.preventDefault(),n._setIndex(n.options.index+1,!0);break;case 33:t.preventDefault(),n._setIndex(n.options.index-n.pagesize,!0);break;case 34:t.preventDefault(),n._setIndex(n.options.index+n.pagesize,!0)}},e(window).on("keydown",n._window_handler_keydown),n._setIndex(n.options.index,!1,!0),n},_destroy:function(){e(window).off("resize",this._window_handler_resize),e(window).off("keydown",this._window_handler_keydown),this.element.height("")},cover:function(){return e(this._getCovers()[this.options.index])},_getCovers:function(){return e("> *",this.element)},_setIndex:function(e,t,n){var i=this,o=i._getCovers();if((e=Math.max(0,Math.min(e,o.length-1)))!==i.options.index)if(o.css("position","absolute"),this._frame(i.options.index),!0===t||0===i.options.duration){i.options.index=Math.round(e);var s="number"==typeof i.options.duration?i.options.duration:jQuery.fx.speeds[i.options.duration]||jQuery.fx.speeds._default;this.refresh(s,i.options.index)}else i.options.index=Math.round(e),i.refresh(0);else!0===n&&(i.refresh(),i._callback("select"))},_callback:function(e,t){this._trigger(e,t,[this._getCovers().get(this.currentIndex),this.currentIndex])},index:function(e){if(e===t)return this.options.index;for(;e<0;)e+=this._getCovers().length;this._setIndex(e,!0)},_frame:function(t){t=t.toFixed(6);var o=this,s=o._getCovers(),r=s.length,a=o.element.innerWidth(),l=o.options.width||s.eq(this.options.index).show().get(0).offsetWidth,d="density"===o.options.visible?Math.round(a*o.options.density/l):e.isNumeric(o.options.visible)?o.options.visible:r,h=o.element.position().left-(1-o.options.outerScale)*l*.5,c=.5*(a-o.options.outerScale*l);o.pagesize=d,s.removeClass("current").each(function(s,l){var u,p=e(l),f=s-t,_=Math.min(Math.max(-1,f/d),1),g=0==f,m=r-Math.abs(Math.round(f)),x=Math.abs(f)<=d,w=Math.sin(_*Math.PI*.5),v=Math.cos(_*Math.PI*.5),b=n(w)*i(Math.abs(w),0,1,o.options.innerOffset*o.options.density,c),C=x?i(Math.abs(v),1,0,o.options.innerScale,o.options.outerScale):0,M=n(w)*i(Math.abs(w),0,1,o.options.innerAngle,o.options.outerAngle),I=g?o.options.selectedCss||{}:e.interpolate&&o.options.outerCss&&!e.isEmptyObject(o.options.outerCss)?x?e.interpolate(o.options.innerCss||{},o.options.outerCss,Math.abs(w)):o.options.outerCss:{};Math.abs(f)<1&&(M=0-(0-M)*Math.abs(f),C=1-(1-C)*Math.abs(f),b=0-(0-b)*Math.abs(f)),u="scale("+C+","+C+") perspective("+.5*a+"px) rotateY("+M+"deg)",p[g?"addClass":"removeClass"]("current"),p[x?"show":"hide"](),p.css(e.extend(I,{left:h+c+b,"z-index":m,"-webkit-transform":u,"-ms-transform":u,transform:u})),o._trigger("animateStep",null,[l,_,x,g,w,v]),t==o.options.index&&o._trigger("animateComplete",null,[l,_,x,g,w,v])})},refresh:function(e,t){var n=this,i=n.currentIndex,o=n._getCovers(),s=o.length,r=!1;n._callback("before"),o.css("position","absolute"),n.element.stop().animate({__coverflow_frame:t||n.options.index},{easing:n.options.easing,duration:e||0,step:function(e,t){n._frame(e),n.currentIndex=Math.max(0,Math.min(Math.round(e),s-1)),i!==n.currentIndex&&(i=n.currentIndex,n._callback("change"),n.currentIndex===n.options.index&&(r=!0))},complete:function(){n.currentIndex=n.options.index,n._callback("after"),r||n._callback("change"),n._callback("select")}})}})}(jQuery);